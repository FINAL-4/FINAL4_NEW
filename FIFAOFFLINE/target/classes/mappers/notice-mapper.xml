<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="noticeMapper">
  
  <resultMap id="noticeResultSet" type="Notice">
  	<id property="nId" column="NID"/>
  	<result property="nTitle" column="NTITLE"/>
  	<result property="nWriter" column="NWRITER"/>
  	<result property="nContent" column="NCONTENT"/>
  	<result property="nCreateDate" column="NCREATEDATE"/>
  	<result property="nModifyDate" column="NMODIFYDATE"/>
  	<result property="filePath" column="FILEPATH"/>
  </resultMap>
  
  <resultMap type="Reply" id="replyResultSet">
  	<id property="rId" column="RID"/>
  	<result property="rContent" column="RCONTENT"/>
  	<result property="refBid" column="REF_BID"/>
  	<result property="rWriter" column="RWRITER"/>
  	<result property="rCreateDate" column="RCREATEDATE"/>
  	<result property="rModifyDate" column="RMODIFYDATE"/>
  	<result property="rStatus" column="RSTATUS"/>
  </resultMap>
  
  <select id="getListCount" resultType="_int">
  	SELECT COUNT(*)
  	FROM NOTICE
  	WHERE STATUS='Y'
  </select>
  
  <select id="selectList" resultMap="noticeResultSet">
  	SELECT *
  	FROM NOTICE
  	ORDER BY NID DESC
  	<!-- ORDER BY N_CREATE_DATE DESC -->
  </select>
  
  <select id="selectOne" parameterType="_int" resultMap="noticeResultSet">
  	SELECT *
  	FROM NOTICE
  	WHERE NID=#{nId}
  </select>
  
   <insert id="insertNotice" parameterType="Notice">
<!-- 	<insert id="insertNotice" parameterType="Notice"> 
		INSERT INTO NOTICE VALUES(
		SEQ_NID.NEXTVAL, #{userName}, #{nTitle}, #{nContent}, #{nWriter}, #{nCount}, SYSDATE, SYSDATE, 'Y', #{filePath}
    </insert> -->
    
  	INSERT INTO NOTICE VALUES(
  		SEQ_NID.NEXTVAL, '1', #{nTitle}, #{nContent}, #{nWriter}, #{nCount}, SYSDATE, SYSDATE, 'Y', #{filePath}
  	)
  </insert> 
  
  
 <update id="updateCount" parameterType="_int"> 
	UPDATE NOTICE SET NCOUNT = NCOUNT + 1 WHERE NID=#{nId}
</update>
    
  <update id="updateNotice" parameterType="Notice">
<!--  	UPDATE NOTICE
 	SET NTITLE=#{nTitle},
 		NCONTENT=#{nContent},
 		FILEPATH=#{filePath}
 	WHERE NID=#{nId} 	 -->
 	<![CDATA[
 	UPDATE NOTICE
 	SET NTITLE=#{nTitle},
 	NCONTENT=#{nContent},
 	FILEPATH=#{filePath}
  	WHERE NID=#{nId} 	 
 		]]>
  </update>
  
  <delete id="deleteNotice" parameterType="_int">
  DELETE NOTICE 
  WHERE NID=#{nId} 	
  </delete>
  
 <select id="selectReplyList" resultMap="replyResultSet" parameterType="_int">
  	SELECT *
  	FROM REPLY R
  	JOIN NOTICE N ON (R.REF_BID=N.NID)
  	WHERE REF_BID=#{nId}
  	ORDER BY RID DESC
 </select>
  
<insert id="insertReply" parameterType="Reply">
	INSERT INTO REPLY VALUES
	(SEQ_RID.NEXTVAL, #{rContent}, #{refBid}, #{rWriter}, SYSDATE, SYSDATE, DEFAULT)
</insert>
  
</mapper>
